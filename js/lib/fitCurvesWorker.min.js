!function(){"use strict";var fmincon,determineRunningConditions,runsTest,linearReg,errorList,robustFit;fmincon=function(){var n,r,t,e;return t=function(t,i,o,a,u){var s,c,f,l,h,g,p,b,m,v,y;for(l={step:a.map(function(n){return n/100}),maxItt:500,minPer:1e-6},f=1/0,m=JSON.parse(JSON.stringify(a)),c=0;c<l.maxItt;c+=1){for(h in m)m.hasOwnProperty(h)&&(m[h]+=l.step[h],n(o,t,i,m)<n(o,t,i,a)?(a[h]=m[h],l.step[h]*=1.2):(m[h]=a[h],l.step[h]*=-.5));if(c%3==0){if(p=n(o,t,i,a),Math.abs(1-p/f)<l.minPer)break;f=p}}if(g=r(i),b=n(o,t,i,a),s=1-Math.min(b/g,1),!t[0]);return 1===t[0].length&&(v=linearReg(t,i),(y=e(function(n){return v.parameters[0]*n[0]+v.parameters[1]},o,a,t,i)).push(Math.log10((1-v.R2)/(1-s)))),{errors:errorList(o,t,i,a),curvature:y,parameters:a,totalSqrErrors:b,R2:s,linearR2:v.R2,linear:v,WWtest:runsTest(o,t,i,a)}},n=function(n,r,t,e){var i,o=0,a=r.length;for(i=0;i<a;i+=1)o+=Math.pow(n(r[i],e)-t[i],2);return o},errorList=function(n,r,t,e){var i,o=[],a=r.length;for(i=0;i<a;i+=1)o.push({error:n(r[i],e)-t[i],y:t[i]});return o},r=function(n){var r,t,e,i;for(t=0,r=0,e=n.length,i=0;i<e;i+=1)r+=n[i];for(r/=e,i=0;i<e;i+=1)t+=Math.pow(n[i]-r,2);return t},e=function(n,r,t,e,i){var o,a,u,s,c,f,l,h;for(o=0,a=0,u=e.length,f=0;f<u;f+=1)s=r(e[f],t),c=n(e[f]),o+=Math.pow(s-c,2),l=Math.pow(s-i[f],2),a+=((h=Math.pow(c-i[f],2))-l)/Math.max(l,h);return o/=u,a/=u,[o,a,runsTest(n,e,i,[])]},t}(),linearReg=function(){var n;return n=function(n,r){var t,e,i,o,a,u=0,s=0,c=0,f=0,l=0,h=n.length;for(t=0;t<h;t+=1)o=1===n[t].length?n[t][0]:n[t].length>1?0:n[t],f+=r[t],c+=o,s+=o*o,l+=r[t]*r[t],u+=o*r[t];return e=(u-c*f/h)/(s-c*c/h),i=(f-e*c)/h,a=Math.pow(u-c*f/h,2)/(s-c*c/h)/(l-f*f/h),{parameters:[e,i],R2:a,errors:errorList(function(n,r){return n[0]*r[0]+r[1]},n,r,[e,i])}},function(r,t){var e,i,o=n(r,t),a=[];for(o.R2=1-(r.length-1)/(r.length-2)*(1-a.R2),a.push(JSON.parse(JSON.stringify(o))),e=0;e<r.length;e+=1)(i=n(r.slice(0,e).concat(r.slice(e+1,r.length)),t.slice(0,e).concat(t.slice(e+1,t.length)))).R2=1-(r.length-1)/(r.length-2)*(1-i.R2),i.R2>o.R2&&(e,o=i),a.push(JSON.parse(JSON.stringify(i)));return o},n}(),robustFit=function(n,r,t,e,i,o,a,u){var s,c,f,l,h,g,p,b,m=[],v=0;for(o?o.length:1,f=function(n){return 1-(1-n.R2)*(n.errors.length-1)/(n.errors.length-n.parameters.length-1)},(l=r(t,e,i,o,a,u)).remove=-1,v+=f(l),m.push([f(l),l,-1]),s=0;s<t.length;s+=1)h=JSON.parse(JSON.stringify(t)),g=JSON.parse(JSON.stringify(e)),h.splice(s,1),g.splice(s,1),p=r(h,g,i,o,a,u),v+=f(p),m.push([f(p),p,s]);return m=m.sort(function(n,r){return n[0]-r[0]}),b=m.pop(),v-=b[0],v/=m.length,c=m.map(function(n){return Math.pow(v-n[0],2)}).reduce(function(n,r){return n+r}),v+2*Math.sqrt(c/m.length)<b[0]&&((l=b[1]).remove=b[2]),l.robust=n,l},determineRunningConditions=function(object){var i,minL,X,xIni,yIni,length,equationObj,linear=!1,retObj,robust=!1;for(X=object.x,xIni=[],yIni=[],length=X.length,"linear"===object.equation.string?linear=!0:equationObj=eval("equationObj="+object.equation.string),i=0;i<length;i+=1)object.valid[i]&&(xIni.push([X[i]]),yIni.push(object.y[i]));if(minL="linear"===object.equation.string?2:3,xIni.length<minL)for(i=0;i<minL;i+=1)object.valid[i]||(xIni.push([X[i]]),yIni.push(object.y[i]));return object.equation.robust&&(robust=object.equation.robust),retObj=linear?{robust:robust,X:xIni,y:yIni,linear:linear}:{robust:robust,params:equationObj.setInitial(xIni,yIni),X:xIni,y:yIni,func:equationObj.func,linear:linear,aoc:object.aoc}},self.onmessage=function(n){var r,t;r=(t=determineRunningConditions(n.data.model)).linear?t.robust?robustFit(t.robust,linearReg,t.X,t.y):linearReg(t.X,t.y):t.robust?robustFit(t.robust,fmincon,t.X,t.y,t.func,t.params,n.data,t.aoc):fmincon(t.X,t.y,t.func,t.params,n.data,t.aoc),self.postMessage([n.data.origin,r])},runsTest=function(){var n,r,t,e,i,o;return n=function(n,r,e,i){var o,a,u,s,c,f,l;for(s=[1,0],c=[1,0],f=0,l=r.length,u=e[0]-n(r[0],i),o=1;o<l;o+=1)(a=e[o]-n(r[o],i))*u<=0&&(c[f=(f+1)%2]+=1),s[f]+=1,u=a;return[t(s[0],s[1],c[0]+c[1]),c[0]+c[1]]},t=function(n,r,t){var e=t%2;return t<2?0:e?(o(n-1,(t-1)/2)*o(r-1,(t-3)/2)+o(n-1,(t-3)/2)*o(r-1,(t-1)/2))/o(n+r,n):2*o(n-1,t/2-1)*o(r-1,t/2-1)/o(n+r,n)},o=function(n,t){var o;return t>n?o=0:r.hasOwnProperty(n)?r[n].hasOwnProperty(t)&&(o=r[n][t]):o=i(n,Math.max(n-t,t))/e(Math.min(n-t,t)),o},e=function(n){var r,t=1;if(n>=1)for(r=n;r>1;r-=1)t*=r;return t},i=function(n,r){var t,e=1;for(t=n;t>r;t+=-1)e*=t;return e},r={1:{0:1,1:1},2:{0:1,1:2,2:1},3:{0:1,1:3,2:3,3:1},4:{0:1,1:4,2:6,3:4,4:1},5:{0:1,1:5,2:10,3:10,4:5,5:1},6:{0:1,1:6,2:15,3:20,4:15,5:6,6:1},7:{0:1,1:7,2:21,3:35,4:35,5:21,6:7,7:1},8:{0:1,1:8,2:28,3:56,4:70,5:56,6:28,7:8,8:1},9:{0:1,1:9,2:36,3:84,4:126,5:126,6:84,7:36,8:9,9:1},10:{0:1,1:10,2:45,3:120,4:210,5:252,6:210,7:120,8:45,9:10,10:1},11:{0:1,1:11,2:55,3:165,4:330,5:462,6:462,7:330,8:165,9:55,10:11,11:1},12:{0:1,1:12,2:66,3:220,4:495,5:792,6:924,7:792,8:495,9:220,10:66,11:12,12:1},13:{0:1,1:13,2:78,3:286,4:715,5:1287,6:1716,7:1716,8:1287,9:715,10:286,11:78,12:13,13:1}},n}()}();